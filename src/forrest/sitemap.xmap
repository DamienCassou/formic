<?xml version="1.0"?>
<!--
  Formic installer framework.
  Copyright (C) 2004 - 2006  Eric Van Dewoestine

  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.

  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
  <map:components>
    <map:actions>
      <map:action logger="sitemap.action.sourcetype" name="sourcetype" src="org.apache.forrest.sourcetype.SourceTypeAction">
        <sourcetype name="hello-v1.0">
          <document-declaration public-id="-//Acme//DTD Hello Document V1.0//EN" />
        </sourcetype>
      </map:action>
    </map:actions>
    <map:selectors default="parameter">
      <map:selector logger="sitemap.selector.parameter" name="parameter" src="org.apache.cocoon.selection.ParameterSelector" />
    </map:selectors>
  </map:components>
  <map:resources>
    <map:resource name="transform-to-document">
      <map:act type="sourcetype" src="{src}">
        <map:select type="parameter">
          <map:parameter name="parameter-selector-test" value="{sourcetype}" />
          <map:when test="hello-v1.0">
            <map:generate src="{properties:content.xdocs}{../../1}.xml" />
            <map:transform src="{properties:resources.stylesheets}/hello2document.xsl" />
            <map:serialize type="xml-document"/>
          </map:when>
        </map:select>
      </map:act>
    </map:resource>
  </map:resources>
  <map:pipelines>
    <map:pipeline>
      <!--
        - Prevent module index files from getting adorned with additional forrest
        - header, footer, nav.
        - Needed as of forrest 0.7
        - (http://forrest.apache.org/docs_0_70/upgrading_07.html#raw)
        -->
      <map:match pattern="**index.html">
        <map:select type="exists">
          <map:when test="{properties:content}{0}">
            <map:read src="{properties:content}/{0}" mime-type="text/html"/>
            <!--
              Use this instead if you want JTidy to clean up your HTML
              <map:generate type="html" src="{properties:content}/{0}" />
              <map:serialize type="html"/>
            -->
          </map:when>
          <map:when test="{properties:content.xdocs}{0}">
            <map:read src="{properties:content.xdocs}/{0}" mime-type="text/html"/>
            <!--
              Use this instead if you want JTidy to clean up your HTML
              <map:generate type="html" src="{properties:content.xdocs}/{0}" />
              <map:serialize type="html"/>
            -->
          </map:when>
        </map:select>
      </map:match>

      <map:match pattern="old_site/*.html">
        <map:select type="exists">
          <map:when test="{properties:content}{1}.html">
            <map:read src="{properties:content}{1}.html" mime-type="text/html"/>
<!--
          Use this instead if you want JTidy to clean up your HTML
          <map:generate type="html" src="{properties:content}/{0}" />
          <map:serialize type="html"/>
        -->
          </map:when>
        </map:select>
      </map:match>
      <map:match pattern="**.xml">
        <map:call resource="transform-to-document">
          <map:parameter name="src" value="{properties:content.xdocs}{1}.xml" />
        </map:call>
      </map:match>
    </map:pipeline>
  </map:pipelines>
</map:sitemap>
